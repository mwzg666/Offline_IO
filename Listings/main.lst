C251 COMPILER V5.60.0,  main                                                               13/10/23  08:58:02  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN main.obj
COMPILER INVOKED BY: D:\KeilMDK\C251\BIN\C251.EXE User\main.c XSMALL INTR2 OPTIMIZE(0,SPEED) BROWSE INCDIR(.\Ads1110;.\i
                    -ic;.\IO;.\mcp4725;.\MwPro;.\uart;.\adc12;.\User) PRINT(.\Listings\main.lst) OBJECT(main.obj) 

stmt  level    source

    1          #include "main.h"
    2          
    3          #define STATUS_MASK 0x3FFC     // 能远程控制的IO值1
    4          #define MODE_MASK    0x00FC    // 能闪烁的IO值1
    5          
    6          WORD  OutStatus = 0;   // 32bit- 0: 关闭  1：打开
    7          WORD  OutMode    = 0;  // 32bit-0: 常亮，1：闪烁
    8          WORD  RunTime    = 0;
    9          WORD  Task1s   = 0;
   10          BOOL  InputReport = FALSE;
   11          BYTE  InputStatus = 0;
   12          BOOL  NeedGetFlow  = TRUE;
   13          BOOL  PaperErr = FALSE;
   14          
   15          BYTE Input_Status = 0;
   16          
   17          PAGER_CTL xdata Paper;
   18          WORD  PaperPluse = 0;
   19          WORD  PaperTimer = 0;
   20          WORD  CommIdleTime = 0;
   21          BASE_INFO xdata g_BaseInfo;
   22          
   23          static WORD OutHis =  0;
   24          
   25          BYTE xdata RecvBuf[UART_BUFF_LENGTH];
   26          BYTE  SendBuf[UART_BUFF_LENGTH];
   27          BYTE RecLength = 0;
   28          
   29          u16  Timer0Cnt = 0;
   30          
   31          WORD xdata FlashIoTimer[32] = {0};    
   32          
   33          //延时函数，
   34          void Error()
   35          {
   36   1          while(1)
   37   1          {
   38   2              RUN_LED(1);
   39   2              Delay(50);
   40   2              RUN_LED(0);
   41   2              Delay(50);
   42   2          }
   43   1      }
   44          
   45          void Delay(WORD ms)
   46          {
   47   1          WORD t = 1000;
   48   1          while(ms--)
   49   1          {
   50   2              for (t=0;t<1000;t++) ;
   51   2          }
   52   1      }
   53          
   54          
   55          void SysInit()
   56          {
   57   1          HIRCCR = 0x80;           // 启动内部高速IRC
   58   1          while(!(HIRCCR & 1));
C251 COMPILER V5.60.0,  main                                                               13/10/23  08:58:02  PAGE 2   

   59   1          CLKSEL = 0;              
   60   1      }
   61          void IoInit()
   62          {
   63   1          EAXFR = 1;
   64   1          WTST = 0;   //设置程序指令延时参数，赋值为0可将CPU执行指令的速度设置为最快
   65   1      
   66   1          P0M1 = 0x00;   P0M0 |= (1<<3)|(1<<4)|(1<<6) ;                     // P0.0 P0.1 P0.4 推挽输出
   67   1          P1M1 = 0x00;   P1M0 |= (1<<4)|(1<<5);                       //设置为准双向口
   68   1          P2M1 = 0x00;   P2M0 |= (1<<0);                      // P2.2 推挽输出
   69   1          P3M1 = 0x00;   P3M0 |= (1<<2)|(1<<3)|(1<<4);        //设置为准双向口
   70   1          P4M1 = 0x00;   P4M0 |= (1<<2)|(1<<3)|(1<<4);                       //设置为准双向
   71   1          P5M1 = 0x00;   P5M0 |= (1<<0) | (1<<2);             //设置为准双向口
   72   1          P6M1 = 0x00;   P6M0 |= (1<<7);     //设置为准双向口
   73   1          P7M1 = 0x00;   P7M0 = 0x00;                         //设置为准双向口
   74   1      }
   75          
   76          void Timer0Init()
   77          {
   78   1          AUXR = 0x00;    //Timer0 set as 12T, 16 bits timer auto-reload, 
   79   1          TH0 = (u8)(Timer0_Reload / 256);
   80   1          TL0 = (u8)(Timer0_Reload % 256);
   81   1          ET0 = 1;    //Timer0 interrupt enable
   82   1          TR0 = 1;    //Tiner0 run
   83   1          
   84   1          // 中断优先级3
   85   1          PT0  = 0;
   86   1          PT0H = 0;
   87   1      }
   88          
   89          // 10ms 中断一下
   90          void Timer0Int (void) interrupt 1
   91          {
   92   1          Timer0Cnt ++;
   93   1      }
   94          
   95          
   96          void Output(BYTE i, BYTE x)
   97          {
   98   1          switch(i)
   99   1          {
  100   2              
  101   2              case BIT_HOST_POWER:    HOST_POWER(x);    break;    // 工控机电源控制
  102   2              case BIT_SYS_POWER:     SYS_POWER(x);     break;    // 工控机电源控制
  103   2              case BIT_SEN_ONOFF:     SEN_POWER(x);     break;    // IO板电源  
  104   2              case BIT_LED_RED:       LED_RED(x);       break;    // 指示灯(红)
  105   2              case BIT_LED_YELLOW:    LED_YELLOW(x);    break;    // 指示灯(黄)
  106   2              case BIT_LED_GREEN:     LED_GREEN(x);     break;    // 指示灯(绿)
  107   2              case BIT_LIGHT_RED:     LIGHT_RED(x);     break;    // 报警灯（红）
  108   2              case BIT_LIGHT_YELLOW:  LIGHT_YELLOW(x); break;     // 报警灯（黄）
  109   2              case BIT_ALARM_SOUND:   ALARM_SOUND(x);   break;    // 报警声控制
  110   2              case BIT_PREA:          PREA(x);          break;    // 预警
  111   2              case BIT_ALARM:         ALARM(x);         break;    // 报警
  112   2              case BIT_CHU_SHUAN:     CHU_SHUAN(x);     break;    // 除酸
*** ERROR C67 IN LINE 112 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 112 OF User\main.c: 'BIT2': undefined identifier
*** ERROR C67 IN LINE 112 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 112 OF User\main.c: 'BIT2': undefined identifier
  113   2              case BIT_CHOU_QI:       CHOU_QI(x);       break;    // 抽气
  114   2              case BIT_ZHOU_ZHI:      ZHOU_ZHI(x);      break;    // 走纸
*** ERROR C67 IN LINE 114 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 114 OF User\main.c: 'BIT6': undefined identifier
*** ERROR C67 IN LINE 114 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 114 OF User\main.c: 'BIT6': undefined identifier
  115   2              case BIT_FAULT:         FAULT(x);         break;    // 故障
  116   2          }
C251 COMPILER V5.60.0,  main                                                               13/10/23  08:58:02  PAGE 3   

  117   1      }
  118          
  119          
  120          // 闪烁 -- 300ms 开 300ms 关
  121          void OutFlash(BYTE i)
  122          {
  123   1          //static BYTE FlashHis = 0;
  124   1          WORD mask = 0;
  125   1          
  126   1          if (FlashIoTimer[i]++ > 20)   // 320ms
  127   1          {
  128   2              FlashIoTimer[i] = 0;
  129   2              
  130   2              mask = 1<<i;
  131   2              if ((OutHis & mask) == 0)
  132   2              {
  133   3                  OutHis |= mask;
  134   3                  Output(i, 1);
  135   3              }
  136   2              else
  137   2              {
  138   3                  OutHis &= ~mask;
  139   3                  Output(i, 0);
  140   3              }
  141   2          }
  142   1      }
  143          
  144          void OutVal(BYTE i, BYTE st)
  145          {
  146   1          WORD mask = 1 << i;
  147   1          WORD his = (WORD)((OutHis >> i) & 1);
  148   1          if (his == st)
  149   1          {
  150   2              return;
  151   2          }
  152   1      
  153   1          if (st)
  154   1          {
  155   2              OutHis |= mask;
  156   2          }
  157   1          else
  158   1          {
  159   2              OutHis &= ~mask;
  160   2          }
  161   1          
  162   1          Output(i, st);
  163   1      }
  164          
  165          // Io输出控制 -- 16ms 运行一次
  166          void OutTask(WORD delta)
  167          {
  168   1          BYTE i, st;
  169   1          WORD mask;
  170   1          for (i=0;i<16;i++)
  171   1          {
  172   2              mask = 1 << i;
  173   2              if ((mask & STATUS_MASK) == 0)
  174   2              {
  175   3                  // 有些IO不能在这里控制
  176   3                  continue;
  177   3              }
  178   2              
  179   2              if ( (OutMode & (1 << i) ) != 0)    // 闪烁模式
  180   2              {
  181   3                  if ((OutStatus & (1 << i)) != 0)
  182   3                  {
C251 COMPILER V5.60.0,  main                                                               13/10/23  08:58:02  PAGE 4   

  183   4                      // 开始闪烁
  184   4                      OutFlash(i);
  185   4                  }
  186   3                  else
  187   3                  {
  188   4                      // 停止闪烁
  189   4                      OutVal(i, 0);
  190   4                  }
  191   3              }
  192   2              else
  193   2              {
  194   3                  st = (OutStatus & (1 << i))?1:0;
  195   3                  OutVal(i, st);
  196   3              }
  197   2          }
  198   1      }
*** WARNING C47 IN LINE 166 OF User\main.c: 'delta': unreferenced parameter
  199          
  200          
  201          void Task_1s()
  202          {
  203   1          #if 0
                   static BYTE on = 1;
                   OutCtl(on,   BIT_ALARM_1);
                   on = !on;
                   #endif
  208   1          
  209   1          //Read4_20ma();
  210   1          //GetFlow();
  211   1      
  212   1          int Voltage = 0;
  213   1      
  214   1          // 需要的是否才采集
  215   1          if (NeedGetFlow)
  216   1          {
  217   2              NeedGetFlow = FALSE;
  218   2              GetAds1110(I2C_GASFLOW1); 
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
C251 COMPILER V5.60.0,  main                                                               13/10/23  08:58:02  PAGE 5   

*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9IN': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9IN': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT1': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9DIR': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'BIT0': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
*** ERROR C67 IN LINE 218 OF User\main.c: 'P9OUT': undefined identifier
